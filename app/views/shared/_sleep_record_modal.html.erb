<dialog id="sleep_record_modal" class="modal" data-title-new="<%= t('modals.sleep_record.title_new') %>" data-title-edit="<%= t('modals.sleep_record.title_edit') %>" data-label-create="<%= t('modals.sleep_record.create') %>" data-label-update="<%= t('modals.sleep_record.update') %>">
  <div class="modal-box max-w-2xl">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"><%= t('modals.sleep_record.close') %></button>
    </form>

    <h2 class="text-2xl font-bold mb-6" id="sleep_record_modal_title"><%= t('modals.sleep_record.title_new') %></h2>

    <%= form_with model: SleepRecord.new, id: "sleep_record_form", class: "space-y-4" do |f| %>
      <div id="sleep_record_errors" class="hidden alert alert-error mb-4">
        <ul id="sleep_record_error_list"></ul>
      </div>

      <!-- 起床時刻 -->
      <div>
        <label class="label">
          <span class="label-text font-semibold flex items-center gap-2">
            <i class="ph-fill ph-sun text-warning text-lg"></i>
            <%= t('modals.sleep_record.wake_time') %>
          </span>
          <span class="label-text-alt text-base-content/60"><%= t('modals.sleep_record.wake_time_note') %></span>
        </label>

        <div class="grid grid-cols-2 gap-3">
          <%= f.date_field :wake_date,
              class: "input input-bordered input-lg",
              required: true,
              id: "modal_wake_date" %>
          <%= f.time_field :wake_time_only,
              class: "input input-bordered input-lg",
              required: true,
              id: "modal_wake_time_only" %>
        </div>

        <%= f.hidden_field :wake_time, id: "modal_wake_time" %>
      </div>

      <!-- 就寝時刻 -->
      <div>
        <label class="label">
          <span class="label-text font-semibold flex items-center gap-2">
            <i class="ph-fill ph-moon text-info text-lg"></i>
            <%= t('modals.sleep_record.bed_time') %>
          </span>
          <span class="label-text-alt text-base-content/60"><%= t('modals.sleep_record.bed_time_note') %></span>
        </label>

        <div class="grid grid-cols-2 gap-3">
          <%= f.date_field :bed_date,
              class: "input input-bordered input-lg",
              id: "modal_bed_date" %>
          <%= f.time_field :bed_time_only,
              class: "input input-bordered input-lg",
              id: "modal_bed_time_only" %>
        </div>

        <%= f.hidden_field :bed_time, id: "modal_bed_time" %>
      </div>

      <div class="flex justify-end gap-2 pt-4 border-t border-base-300" id="sleep_record_modal_footer">
        <!-- 削除ボタン（編集時のみ表示） -->
        <button type="button"
                onclick="deleteSleepRecord()"
                class="btn btn-error btn-outline hidden"
                id="sleep_record_delete_btn">
          <%= t('modals.sleep_record.delete') %>
        </button>

        <div class="flex gap-2">
          <button type="button" onclick="sleep_record_modal.close()" class="btn btn-outline"><%= t('modals.sleep_record.cancel') %></button>
          <%= f.submit t('modals.sleep_record.create'), class: "btn btn-primary", id: "sleep_record_submit_btn" %>
        </div>
      </div>
    <% end %>

    <!-- 削除フォーム -->
    <form id="sleep_record_delete_form" method="post" style="display: none;">
      <input type="hidden" name="_method" value="delete">
      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<%= javascript_include_tag 'sleep_record_modal' %>
