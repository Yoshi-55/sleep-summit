<% content_for :page_title do %>
  <%= t('history.index.page_title') %>
<% end %>

<div class="flex flex-col gap-3 sm:gap-4 lg:gap-6">
  <!-- 活動グラフ -->
  <%= render 'shared/card' do %>
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-2xl font-bold"><%= t('history.index.activity_graph') %></h3>
      <%= form_with url: history_path, method: :get, local: true, class: "flex gap-2 items-center", id: "history-form" do %>
        <%= select_tag :year,
            options_for_select((2025..Date.current.year).to_a.reverse, @selected_year),
            class: "select select-bordered select-sm w-20",
            onchange: "this.form.submit();" %>
        <label for="year" class="text-xs"><%= t('history.index.year') %></label>

        <%= select_tag :month,
            options_for_select((1..12).to_a, @selected_month),
            class: "select select-bordered select-sm w-16",
            onchange: "this.form.submit();" %>
        <label for="month" class="text-xs"><%= t('history.index.month') %></label>
      <% end %>
    </div>
    <div class="overflow-x-auto">
      <div id="sleep-chart"
          data-series='<%= @series.to_json.html_safe %>'
          class="min-w-[1200px] h-[250px] sm:h-[300px] lg:h-[350px]">
      </div>
    </div>
  <% end %>

  <!-- 記録テーブル -->
  <%= render 'shared/sleep_records_table',
      records: @monthly_records,
      title: t('history.index.this_month_records') %>

  <!-- 月間統計 -->
  <%= render 'shared/sleep_stats_cards',
      average_wake_hours: @month_average_wake_hours,
      average_sleep_hours: @month_average_sleep_hours,
      average_wake_time: @month_average_wake_time,
      average_bed_time: @month_average_bed_time,
      average_wake_hours_label: t('history.index.month_average_wake_hours'),
      average_sleep_hours_label: t('history.index.month_average_sleep_hours'),
      average_wake_time_label: t('history.index.month_average_wake_time'),
      average_bed_time_label: t('history.index.month_average_bed_time') %>
</div>
