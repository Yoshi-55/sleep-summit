<div class="min-h-screen">
  <div class="container mx-auto p-8">
    <div class="navbar mb-4">
      <div class="navbar-start">
        <h1 class="text-5xl font-bold text-base-content">History</h1>
      </div>
      <div class="navbar-end flex gap-2 items-center">
        <span class="text-base-content/70 text-sm">
          <%= t('navbar.welcome', name: current_user.name) %>
        </span>
      </div>
    </div>

    <!-- 活動グラフ -->
    <div class="card bg-base-100 border border-base-300 mb-6">
      <div class="card-body p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-2xl font-bold">活動グラフ</h3>
          <span class="badge badge-outline">月</span>
        </div>
        <div id="sleep-chart"
             data-series='<%= @series.to_json.html_safe %>'
             style="height: 350px;">
        </div>
      </div>
    </div>

    <!-- 月間統計 -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="card bg-base-100 border border-base-300 text-center p-4">
        <div class="text-xs text-base-content/70 mb-2">月/平均活動時間</div>
        <div class="text-2xl font-bold text-success">
          <%= @month_average_wake_hours ? sprintf("%.1f", @month_average_wake_hours) : '-' %>h
        </div>
      </div>
      <div class="card bg-base-100 border border-base-300 text-center p-4">
        <div class="text-xs text-base-content/70 mb-2">月/平均睡眠時間</div>
        <div class="text-2xl font-bold text-info">
          <%= @month_average_sleep_hours ? sprintf("%.1f", @month_average_sleep_hours) : '-' %>h
        </div>
      </div>
      <div class="card bg-base-100 border border-base-300 text-center p-4">
        <div class="text-xs text-base-content/70 mb-2">月/平均起床時刻</div>
        <div class="text-2xl font-bold text-success">
          <%= @month_average_wake_time || '-' %>
        </div>
      </div>
      <div class="card bg-base-100 border border-base-300 text-center p-4">
        <div class="text-xs text-base-content/70 mb-2">月/平均就寝時刻</div>
        <div class="text-2xl font-bold text-info">
          <%= @month_average_bed_time || '-' %>
        </div>
      </div>
    </div>

    <!-- 記録テーブル -->
    <div class="card bg-base-100 border border-base-300">
      <details class="group [&_summary::-webkit-details-marker]:hidden">
        <summary class="cursor-pointer p-4 font-bold text-xl bg-base-100 flex justify-between items-center rounded-t-lg">
          今月の記録
          <span class="transition-transform duration-300 group-open:rotate-180">⤵︎</span>
        </summary>
        <div class="overflow-x-auto p-4">
          <table class="table table-zebra w-full border-t border-base-300">
            <thead class="bg-base-200">
              <tr>
                <th>日付</th>
                <th>起床時刻</th>
                <th>就寝時刻</th>
                <th>活動時間（h）</th>
                <th>睡眠時間（h）</th>
                <th>月累計活動（h）</th>
                <th>月累計睡眠（h）</th>
              </tr>
            </thead>
            <tbody>
              <% @monthly_records.each do |record| %>
                <tr class="hover">
                  <td><%= record[:day].is_a?(Date) ? record[:day].strftime("%m-%d (%a)") : '--' %></td>
                  <td>
                    <% if record[:wake_times].present? %>
                      <% record[:wake_times].each do |time| %>
                        <span class="badge badge-success badge-sm block mb-1"><%= time.split(' ').last %></span>
                      <% end %>
                    <% else %>
                      <span class="text-base-content/40">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% if record[:bed_times].present? %>
                      <% record[:bed_times].each do |time| %>
                        <span class="badge badge-secondary badge-sm block mb-1"><%= time.split(' ').last %></span>
                      <% end %>
                    <% else %>
                      <span class="text-base-content/40">-</span>
                    <% end %>
                  </td>
                  <td class="text-accent font-semibold">
                    <%= record[:daily_wake_hours] ? sprintf("%.1f", record[:daily_wake_hours]) : '-' %>
                  </td>
                  <td class="text-info font-semibold">
                    <%= record[:daily_sleep_hours] ? sprintf("%.1f", record[:daily_sleep_hours]) : '-' %>
                  </td>
                  <td class="text-accent text-sm font-semibold">
                    <%= record[:cumulative_wake_hours] || '-' %>
                  </td>
                  <td class="text-info text-sm font-semibold">
                    <%= record[:cumulative_sleep_hours] || '-' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </details>
    </div>
  </div>
</div>